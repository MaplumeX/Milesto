# Milesto PRD - v0.3（Sync: 可选同步与多端）

版本: v0.3
状态: Done
前置: v0.2（提醒/重复/组织增强）
目标周期: 6-10 周（建议）

## 1. 迭代目标

- 在不牺牲 local-first 体验的前提下，提供可靠的多端同步。
- 同步必须“可解释、可恢复”: 冲突可见、可手动处理，避免 silent merge。
- 把同步作为可选模块: 不同步的用户也能完整使用。

## 2. 范围定义

### 2.1 In Scope

- 同步 PoC（至少一种模式）
  - 方案 A: 自建服务（Milesto Sync）
  - 方案 B: WebDAV/文件同步（用户自行选择存储提供方）
- 冲突检测与解决
- 同步状态可视化（成功/失败/落后/冲突）
- 最低限度的安全设计（例如传输加密）

### 2.2 Out of Scope

- 团队协作
- 端到端加密（如资源允许可作为 P1，但不强行塞进 v0.3）
- 插件/自动化

## 3. 用户故事

1. 作为用户，我能在两台设备上看到同一套任务数据。
2. 作为用户，我在离线编辑后重新联网，同步能自动恢复。
3. 作为用户，如果两台设备同时改了同一个任务，我能看到冲突并选择保留哪个。

## 4. 功能需求与验收标准

### 4.1 同步开关与账号/连接（P0）

- 同步是可选功能
  - 验收: 默认关闭; 开启需要明确操作; 可随时关闭。
- 连接配置
  - 验收: 用户可配置同步端点/凭据（如果需要）; 配置错误有明确错误提示。

### 4.2 同步引擎（P0）

- 双向同步
  - 验收: 在设备 A 创建/编辑/完成任务后，设备 B 能同步到一致状态。
- 断网恢复
  - 验收: 离线状态下可正常使用; 恢复联网后可补齐同步。
- 幂等性
  - 验收: 重试不会造成重复对象/重复完成记录。

### 4.3 冲突策略与解决（P0）

- 冲突检测
  - 验收: 当同一对象在不同设备上并发修改且无法自动安全合并时，进入冲突状态。
- 冲突可视化
  - 验收: UI 能展示冲突字段差异（至少 title/notes/dates/project/tags）。
- 冲突解决
  - 验收: 用户可选择“保留本地/保留远端/手动合并（可选）”; 解决后同步恢复正常。

### 4.4 同步状态与可观察性（P1）

- 同步日志/错误
  - 验收: 用户可看到最近一次同步时间与错误原因; 支持一键重试。

## 5. 安全与隐私

- 默认不收集行为数据; 同步日志仅本地可见。
- 传输加密（HTTPS/WebDAV TLS）是最低要求。

## 6. 风险与对策

- 复杂度爆炸: v0.3 只做 PoC + 关键闭环（双向、冲突、可恢复），其余能力后置。
- 数据模型不稳定导致频繁迁移: 在 v0.2 之后再引入同步，减少变更面。

## 7. 交付清单

- 至少一种同步模式可用（PoC）
- 冲突检测与解决可用
- 同步状态可见，失败可重试
