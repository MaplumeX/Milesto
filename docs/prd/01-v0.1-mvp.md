# Milesto PRD - v0.1 MVP

版本: v0.1
状态: Draft
日期: 2026-01-28

本 PRD 定义 Milesto 在 v0.1 阶段需要交付的 MVP（Minimum Viable Product）。
它以 `docs/prd/00-overview.md` 的愿景/对象模型为基础，并严格遵守 `docs/redlines.md` 的范围红线与 `docs/tech-framework.md` 的技术约束。

## 0. 一句话定义

一个本地优先、键盘优先的个人任务管理桌面应用：支持快速收集、Today 规划、项目推进、全局搜索与数据可导入/导出。

## 1. 目标与成功标准

### 1.1 目标（v0.1 必达）

- 日常可用闭环：收集 -> 整理 -> 执行 -> 回顾。
- 本地优先：无需账号即可使用；离线可用；数据可导出、可迁移。
- 低摩擦与键盘优先：高频操作尽量在 1-2 次键盘交互内完成。
- 性能底线：10k 任务规模下，搜索首屏 < 200ms；列表滚动无明显卡顿（虚拟滚动）。

### 1.2 成功标准（验收用）

- 新用户 10 分钟内完成：创建 1 个项目、录入 10 个任务、完成 1 次 Today 规划（含排序）。
- 核心数据可靠：导入/导出全程事务；无已知导致数据丢失的缺陷。
- 交互可用：命令面板可用；列表键盘导航可用；常见错误可提示并可恢复。

## 2. 范围

### 2.1 In Scope（v0.1 做什么）

按优先级拆分：P0 = MVP 必须；P1 = v0.1 内尽量做，但可在不影响 MVP 的前提下延期。

#### P0（MVP 必须）

1) 导航与信息架构（IA）

- 固定入口：Inbox / Today / Upcoming / Anytime / Someday / Logbook / Areas/Projects（列表）/ Settings。
- Sidebar + Content 的两栏布局（对齐 `docs/ui.md`）。
- Sidebar 需要展示 Areas/Projects 列表（同一个 list）：
  - 展示结构：
    - 顶部区域（无标题）：展示所有 area_id 为空的 open Projects（未归属 Area 的项目）。
    - 下部区域：按 Area 分组（可折叠）/可点击入口，其下嵌套展示该 Area 下的 open Projects。
  - Area 显示规则：即使该 Area 下没有任何 open Projects（空 Area），也要在侧边栏显示该 Area 分组。
  - 约束：侧边栏仅显示 status = open 的项目（已完成项目不在侧边栏出现）。

2) 任务（Task）核心能力

- 新建/编辑任务：title（必填）、notes（可选，Markdown 文本存储即可）。
- 状态：完成/未完成切换；完成后进入 Logbook。
- 归属与日期：
  - 可分配到 Project（可空）。
  - 可设置 scheduled_at（决定是否进入 Today/Upcoming）。
  - 可设置 due_at（用于风险提示；v0.1 仅需在 UI 可见，不强制复杂提醒）。
- 列表语义（base list）：任务至少能处在 Inbox / Anytime / Someday 三者之一（用于“整理”闭环）。

3) Today 规划与排序持久化

- Today 展示规则：显示 scheduled_at = today 的未完成任务。
- Today 支持排序：拖拽或键盘移动；重启后顺序保持。

4) 项目（Project）

- 新建/编辑项目：title、notes（可选）。
- Project sections（v0.1 纳入）：
  - 项目支持配置多个 section（仅标题）。
  - 项目视图内按 section 分组展示任务；允许把任务分配/移动到某个 section（或不属于任何 section）。
  - 展示结构（与侧边栏 Areas/Projects 的“隐式分段”一致）：
    - 顶部区域（无标题）：展示 section_id 为空的任务（未归属 section 的任务）。
    - 下部区域：按 section 分组展示该 section 下的任务。
    - section 显示规则：即使该 section 下没有任何任务（空 section），也要显示该 section 分组。
  - section 至少支持创建/重命名/删除。
    - 删除 section 时：不删除任务；该 section 下任务需要“顺位上移”并入上一个 section。
      - 若被删除的是第 1 个 section（不存在上一个 section）：这些任务进入“未归属 section”的顶部区域（section_id 置空）。
- 项目内任务列表：可查看/添加任务到项目。
- 项目内排序持久化：项目视图内的任务顺序可调整并持久化（与 Today 排序互不干扰）。

5) 搜索（全局）

- 全局搜索 Task 的 title + notes（对齐 `docs/tech-framework.md`：FTS5 优先）。
- 结果默认只包含必要字段；可切换是否包含 Logbook。
- 入口：内容区底部栏的 `Search` 按钮打开居中搜索面板（SearchPanel）。

6) 键盘优先与搜索面板（SearchPanel）

- v0.1 默认不提供 `Cmd/Ctrl + K` 的全局入口。
- SearchPanel 支持：
  - 输入即搜索任务（title + notes）。
  - 上下键移动结果高亮；`Enter` 选择并跳转；`Escape` 或点击遮罩关闭。
  - 仅搜索：不提供命令列表，不支持“无结果回车创建任务”。
- 列表键盘导航：上下选择、Enter 打开详情、Space 切换完成状态（具体键位可在实现时对齐平台习惯）。

7) 导入/导出（JSON）

- 导出：包含 `schema_version`、`app_version`、`exported_at` 元信息；包含 tasks/projects/tags/areas（即便 tags/areas 暂不做 UI，也应预留结构）。
- 导入：全程事务；导入失败必须回滚；至少提供两种策略之一：
  - 清空后导入（覆盖）。
  - 按 id 合并（同 id 更新，不同 id 新增）。

8) 设置（Settings）

- 数据导入/导出入口。
- 打开数据目录/导出文件所在目录（便于备份）。
- About：版本信息、快捷键说明链接。

#### P1（可选增强）

P1 目标：在不扩大 v0.1 范围红线（同步/提醒/重复/团队等）的前提下，补齐“整理与回顾”的效率与表达力。

1) Tags（标签）

- 最小能力：
  - CRUD：创建/重命名/删除标签。
  - 颜色：标签可配置 color（可选；建议提供有限预设色）。
  - 赋值：任务可添加/移除多个标签。
- 入口与交互：
  - 不提供独立的 Tags 导航入口/侧边栏入口。
  - 标签管理入口放在任务编辑的标签选择器中就地创建/重命名。
  - （可选）在任务列表提供按标签筛选的过滤器，但不单独提供 Tag 视图页面。
- 边界：
  - 不做层级标签/嵌套标签。
  - 不做复杂规则（例如自动打标签）。

2) Areas（领域）

- 最小能力：
  - CRUD：创建/重命名/删除 Area。
  - 归属：Project 可设置 area_id（可空）；Task 可设置 area_id（可空）。
- 删除规则（v0.1 明确）：
  - 删除 Area 采用软删除（设置 deleted_at，不做物理删除）。
  - 级联：删除 Area 时，软删除其下所有 Projects，并软删除这些 Projects 下的所有 Tasks。
  - 说明：该行为会影响数据可见性与导出；实现需要确保导入/导出与筛选逻辑一致且可解释。
- 入口与交互：
  - 侧边栏 Areas/Projects 列表中，Area 作为分组标题与可点击入口；其下嵌套展示该 Area 下的 open Projects。
  - Area 视图：展示该 Area 下的 Projects 与 Tasks（至少支持列表）。
- 边界：
  - 不做层级 Area（无父子关系）。
  - 不做 Area 级别权限/共享。

3) Checklist items（任务清单子项）

- 最小能力：
  - 在任务详情中管理 checklist_items：新增/编辑标题/勾选完成/删除。
  - 勾选状态仅影响子项，不自动完成父任务（避免隐式规则）。
- 交互：
  - 键盘可用（上下移动焦点、Enter 编辑/新增、Space 勾选）。
- 边界：
  - 不做子项提醒/重复。
  - 不做复杂排序策略（如需排序，v0.1 可先按创建顺序）。

4) Upcoming 视图增强（仍只按 scheduled_at）

- 最小能力：
  - 按日期分组展示（Today/明天/本周/更远或直接按日期标题）。
  - 快速跳转：今天/本周/本月（仅影响滚动定位，不改变数据）。
- 边界：
  - 仍只按 scheduled_at；scheduled_at 为空不展示（即使 due_at 存在）。

5) Logbook 回收能力（恢复未完成）

- 最小能力：
  - 在 Logbook 中对已完成任务提供“恢复为未完成”操作。
  - 恢复规则：仅将 status 从 done 变为 open，并清空 completed_at；不清除 project/section/base list/scheduled_at/due_at/tags/area 等字段。
- 边界：
  - 不做批量恢复/撤销栈（如需撤销可在后续版本补齐）。

### 2.2 Out of Scope（v0.1 明确不做）

以下内容与 `docs/redlines.md` 对齐，v0.1 禁止实现：

- 账号体系/登录/云端同步/多端同步。
- 提醒（系统通知）与重复任务（Repeat rules）。
- 团队协作/多人共享。
- 日历双向集成。
- 自动更新（禁止引入 `electron-updater` 或同类）。

## 3. 关键用户流程（MVP）

### 3.1 快速收集（Inbox）

- 用户通过快捷键打开命令面板 -> 输入标题 -> 回车创建 -> 任务进入 Inbox。

### 3.2 整理（从 Inbox 到项目/计划）

- 用户在 Inbox 选中任务：
  - 分配到某个 Project：任务离开 Inbox，base list 默认归属为 Anytime。
  - 设置 scheduled_at（包含 today/未来日期）：任务离开 Inbox，base list 默认归属为 Anytime。
  - 手动移动到 Anytime/Someday：任务离开 Inbox，base list 以用户选择为准。

说明：离开 Inbox 仅代表“已整理”，不应清除任务的其他字段（例如 project_id、scheduled_at、due_at）。

### 3.3 执行（Today）

- 用户在 Today 对任务排序 -> 逐个完成 -> 完成项进入 Logbook。

### 3.4 回顾（Logbook / Someday）

- 用户可查看已完成记录（Logbook），以及低优先事项（Someday）避免遗忘。

## 4. 列表语义（必须明确，避免实现歧义）

v0.1 采用“base list + 派生视图”的语义：

- base list（显式字段）：Inbox / Anytime / Someday。
- Today（派生）：scheduled_at = today 且 status = open。
- Upcoming（派生）：scheduled_at > today 且 status = open。
  - 规则：仅按 scheduled_at；若 scheduled_at 为空则不在 Upcoming 显示（即使 due_at 存在）。
- Logbook（派生）：status = done（包含已完成任务与已完成项目）。

说明：base list 负责“整理意图”（是否已处理/暂缓），Today/Upcoming 负责“时间意图”。

## 5. 数据与一致性要求（产品侧要求，但落地需对齐技术框架）

### 5.1 Sync-ready 最小约束（v0.1 就要具备）

- 核心对象 ID 使用 UUID（建议 UUIDv7）。
- 预留软删除字段 `deleted_at`。
- `updated_at` 在任何变更时可靠更新。

### 5.2 排序持久化

- Today 排序与项目内排序必须相互独立（避免一个 `order` 字段互相干扰）。
- 推荐以 `list_positions(list_id, task_id, rank)` 的概念落地（细节见 `docs/tech-framework.md`）。

### 5.3 导入/导出可靠性

- 导入全程事务；失败必须全量回滚。
- 导出需包含最小元信息：`schema_version/app_version/exported_at`。

## 6. 验收标准（面向 v0.1 发布）

### 6.1 功能验收

- 任务：可创建/编辑/完成；可分配项目；可设置 scheduled_at / due_at。
- 列表：Inbox/Anytime/Someday 可用；Today/Upcoming/Logbook 规则一致且可解释。
- 排序：Today 与项目内排序可调整且重启后保持。
- Project sections：可在项目内创建/重命名/删除 section；任务可被分配到 section 并按 section 分组展示。
- 搜索：可在 10k 任务规模下稳定返回结果；可选包含 Logbook。
- 导入/导出：导出后清空数据再导入，数据完整一致（包含排序与日期字段）。
- 设置：存在导入/导出入口；可打开数据目录；无默认 telemetry。

补充：侧边栏 Projects 列表仅显示 open 项目。

补充：侧边栏 Projects 在视觉上分为两段：上方为未归属 Area 的 open Projects（无分组标题），下方为按 Area 分组的 open Projects。

### 6.2 性能验收（目标值）

- 冷启动到可交互：< 1s（桌面/本地环境目标值）。
- 搜索首屏：< 200ms（10k 任务规模）。
- 长列表滚动：无明显卡顿（任务列表虚拟滚动）。

### 6.3 P1 验收（若实现 P1 增强）

- Tags：支持 CRUD/颜色预设/任务多标签；不提供独立 Tags 导航入口；可在 Settings 或任务编辑中管理。
- Areas：支持 CRUD；Project/Task 可设置 area_id；Area 视图可浏览相关 Projects/Tasks。
- Checklist：子项可新增/编辑/勾选/删除；全键盘可用；不隐式完成父任务。
- Upcoming 增强：仅按 scheduled_at 分组与跳转；scheduled_at 为空不出现。
- Logbook 恢复：恢复仅改 status/completed_at；其余字段不被清除；恢复后可回到对应视图展示。

## 7. 风险与对策（v0.1 重点）

- better-sqlite3 原生依赖跨平台构建风险：尽早在三平台打包验证（对齐 `docs/tech-framework.md`）。
- 搜索性能与一致性：FTS5 + triggers 维护需要谨慎；接口需支持过滤 open/done 与是否包含 Logbook。
- 排序持久化复杂度：不要用单一 `order` 字段；采用独立位置体系。
- 范围蔓延：v0.1 明确不做同步/提醒/重复；任何破例必须先改 PRD 并走红线例外流程。

## 8. 里程碑建议（供实现拆分用）

- M0（1-2 周）：骨架 + DB Worker + 最小 CRUD + 基础列表页面跑通。
- M1（2-4 周）：v0.1 MVP：Today/项目排序持久化、FTS5 搜索、命令面板、导入/导出。

## 9. 未决问题（实现前需确认）

v0.1 关键交互规则已确认；如实现中出现新增歧义，再在此补充。
