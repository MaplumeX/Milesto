# Milesto v0.1 任务划分（Task Breakdown）

版本: v0.1
状态: Draft
日期: 2026-01-28

本文件用于把 `docs/prd/01-v0.1-mvp.md` 的 v0.1 MVP 范围，结合工程/红线规范与 UI 原型参考，拆分成“数量不多但可执行”的交付任务，方便后续按里程碑推进。

## 0. 参考资料（本任务划分的输入）

- PRD 索引: `docs/PRD.md`
- 产品概览: `docs/prd/00-overview.md`
- v0.1 MVP: `docs/prd/01-v0.1-mvp.md`
- 红线（禁止事项）: `docs/redlines.md`
- 工程规范: `docs/standards.md`
- UI 设计规范: `docs/ui.md`
- 技术框架: `docs/tech-framework.md`
- UI 原型（Vite 子项目，仅作交互/布局参考）:
  - `docs/design/prototype interface/App.tsx`
  - `docs/design/prototype interface/components/Sidebar.tsx`
  - `docs/design/prototype interface/components/TaskView.tsx`

## 1. v0.1 范围与边界（先对齐，再拆任务）

### 1.1 In Scope（v0.1 必达 P0）

来自 `docs/prd/01-v0.1-mvp.md`：

- IA/导航：Inbox / Today / Upcoming / Anytime / Someday / Logbook / Areas+Projects（侧边栏）/ Settings
- Task：创建/编辑/完成；notes（Markdown 文本存储即可）；project 归属；scheduled_at / due_at
- Today：按 scheduled_at=today 派生；排序可调整并持久化
- Project：创建/编辑；Project sections（空分组也显示；删除 section 的迁移规则）
- 搜索：全局搜索 Task title+notes（FTS5 优先），可选包含 Logbook
- 键盘优先：`Cmd/Ctrl+K` 命令面板；列表键盘导航
- 导入/导出：JSON；事务；覆盖或按 id 合并策略（二选一即可）
- 设置：导入/导出入口；打开数据目录；About 信息

### 1.2 Out of Scope（v0.1 明确不做）

来自 `docs/prd/01-v0.1-mvp.md` 与 `docs/redlines.md`：

- 账号/登录/云端同步/多端同步
- 提醒（系统通知）与重复任务
- 团队协作/共享
- 日历双向集成
- 自动更新（禁止引入 `electron-updater` 或同类）

### 1.3 强制工程/安全/架构约束（红线）

来自 `docs/redlines.md` 与 `docs/tech-framework.md`：

- Electron 安全基线：`contextIsolation: true`、`nodeIntegration: false`、禁用 remote、CSP 禁 `unsafe-eval`
- Renderer 不得直接使用 `ipcRenderer`；只能通过 `window.api.*`
- Preload 不得暴露高危原语（任意 SQL、任意 FS 等）
- DB 必须在 `worker_threads` DB Worker 中访问；不在 Main/Renderer 直接操作 SQLite
- DB 写入必须事务化；导入/批量写入失败必须全量回滚
- 性能底线：10k 任务规模下搜索首屏 < 200ms；列表必须虚拟滚动；列表不要全量取 notes 等大字段

## 2. 里程碑建议（不新增范围，只调整顺序）

对齐 `docs/prd/01-v0.1-mvp.md` 的 M0/M1：

- M0（骨架可跑通，能写入可靠数据）：阶段 1-2 + 阶段 3 的“任务闭环最小集”
- M1（MVP 可用闭环）：阶段 3-5 全量完成（排序/搜索/命令面板/导入导出/设置/发布验证）

说明：下面采用“阶段（<=5）”作为推进单位；每个阶段内部可以拆成 1-2 个 PR，不强制再细分成更多阶段。

## 3. v0.1 阶段划分（不超过 5 个阶段）

说明：阶段是推进单位（最多 5 个）。每个阶段内部可以按需要拆 1-2 个 PR；但阶段数量保持稳定，避免把 v0.1 切得太碎。

### 阶段 1：应用骨架 + 安全基线 + 边界（AppShell / window.api / IPC）

目标：把“可运行且不踩红线”的骨架搭起来，为后续所有功能提供稳定边界。

交付物：

- Electron 安全基线（`contextIsolation`/`nodeIntegration`/CSP/禁 remote）
- `AppShell` 两栏布局（Sidebar + Content），路由建议 `HashRouter`
- Preload 暴露 `window.api.*` 业务级 API；Renderer 不直接使用 `ipcRenderer`
- IPC：`handle/invoke` 模型；schema 校验；统一 `AppError { code, message, details? }`；校验 sender

验收标准：

- 应用启动后可通过 Sidebar 切换到核心入口页（可先占位）
- 任意非法 IPC payload 返回稳定错误结构，UI 只展示 `code/message`

依赖：无

参考：`docs/redlines.md`、`docs/standards.md`、`docs/ui.md`、`docs/tech-framework.md`

### 阶段 2：DB Worker + 数据模型 + 迁移（v0.1 基础表结构）

目标：建立可靠的本地存储地基（事务、迁移、可演进的数据结构），并为搜索/排序/导入导出预留结构。

交付物：

- DB Worker 协议（request/response + 超时/崩溃恢复策略）
- SQLite pragma 基线（WAL/foreign_keys/busy_timeout 等）
- schema/migrations（至少覆盖 v0.1 P0 所需字段）：
  - tasks / projects / areas / project_sections
  - list_positions（Today 与 Project 两套排序互不干扰）
  - tasks_fts（FTS5 表结构占位，完整实现放到阶段 4）
  - （为导入/导出预留）tags / task_tags 等结构：允许先无 UI，但数据结构需可演进

验收标准：

- DB 文件位于用户数据目录（不进入 asar）
- 所有写入在事务中执行；导入/批量写入失败可全量回滚（能力先落 DB 侧）

依赖：阶段 1

参考：`docs/redlines.md`、`docs/standards.md`、`docs/tech-framework.md`、`docs/prd/00-overview.md`

### 阶段 3：核心闭环（Task + 列表语义 + Project/Sections + Sidebar 规则）

目标：实现 v0.1 的日常可用闭环（收集/整理/执行/回顾），并把 Project/Sections 与侧边栏规则落地。

交付物：

- Task：创建/编辑/完成；title 必填；notes 文本存储；project 归属；scheduled_at / due_at
- 列表语义：
  - base list：Inbox / Anytime / Someday
  - Today：scheduled_at=today 且 status=open
  - Upcoming：scheduled_at>today 且 status=open（仅按 scheduled_at；scheduled_at 为空不出现）
  - Logbook：status=done
- Project：创建/编辑；项目内任务列表
- Project sections：创建/重命名/删除；空 section 也显示；删除 section 的任务迁移规则符合 PRD
- Sidebar：固定入口 + Areas/Projects 展示规则
  - 顶部：area_id 为空的 open Projects（无标题）
  - 下部：按 Area 分组（可折叠），其下展示 open Projects；空 Area 分组也显示

验收标准：

- 创建任务默认进入 Inbox；完成任务进入 Logbook 且不丢字段
- Project/Sections 的分组与删除迁移规则符合 `docs/prd/01-v0.1-mvp.md`
- Sidebar 仅展示 open Projects，且 Areas 分组规则正确

依赖：阶段 2

参考：`docs/prd/01-v0.1-mvp.md`、`docs/ui.md`

### 阶段 4：性能与效率（虚拟滚动 + 排序持久化 + 搜索 + 命令面板）

目标：把 v0.1 的“键盘优先 + 性能底线”落地：长列表不卡、两套排序不互相干扰、搜索可用且可扩展到指标。

交付物：

- 列表虚拟滚动（10k 规模强制）；列表只取必要字段，notes 等大字段按需加载
- 列表键盘导航：上下选择、Enter 打开详情、Space 切换完成（按平台习惯微调）
- 排序持久化：
  - Today 排序可调整并持久化
  - Project 视图排序可调整并持久化
  - 两套排序通过 list_positions 独立存储，互不干扰
- FTS5 全局搜索：title+notes；默认不含 Logbook；支持切换是否包含 Logbook
- 命令面板：`Cmd/Ctrl+K` 打开；支持“创建任务 / 跳转视图 / 搜索并定位”

验收标准：

- 10k 任务规模下列表滚动无明显卡顿（具备虚拟化）
- 重启后 Today 与 Project 内顺序保持且互不影响
- 从命令面板可搜索任务并定位到对应列表/项目

依赖：阶段 3

参考：`docs/redlines.md`、`docs/ui.md`、`docs/tech-framework.md`

### 阶段 5：数据可迁移 + 设置 + 发布前验证（导入/导出/打包冒烟）

目标：补齐 v0.1 的“可迁移/可备份/可交付”能力，确保一致性与发布风险可控。

交付物：

- JSON 导出：`schema_version/app_version/exported_at` + tasks/projects/areas/tags
- JSON 导入：全程事务；失败全量回滚；提供一种策略（覆盖导入或按 id 合并）
- Settings：导入/导出入口；打开数据目录/导出目录；About（版本信息、快捷键说明链接）
- 发布前验证清单：核心流程回归 + 打包冒烟（重点 better-sqlite3 原生依赖跨平台风险）

验收标准：

- 导出 -> 清空 -> 导入后数据一致（含排序位置、日期字段、完成状态等）
- 导入失败不留下半套数据
- 至少目标平台可成功打包并运行；better-sqlite3 可用

依赖：阶段 4

参考：`docs/prd/01-v0.1-mvp.md`、`docs/redlines.md`、`docs/tech-framework.md`、`docs/standards.md`

## 4. P1（可选增强，不计入阶段）建议拆分

若 v0.1 在 P0 完成后仍有余量，建议把以下能力作为独立任务追加（每项都可能牵涉数据模型与 UI，避免混入 P0 PR）：

- P1-A Tags：CRUD/颜色预设/任务多标签（无独立 Tags 导航入口）
- P1-B Areas：CRUD；Project/Task 归属；删除 Area 的软删除级联规则（注意影响导入/导出与筛选一致性）
- P1-C Checklist items：子项增删改勾选；全键盘可用
- P1-D Upcoming 增强：按日期分组与跳转（仍只按 scheduled_at）
- P1-E Logbook 恢复：已完成任务恢复为未完成（仅改 status/completed_at）

参考：`docs/prd/01-v0.1-mvp.md` P1 段落

## 5. 建议的 PR 切分方式（避免大杂烩）

为了降低评审与回归风险：

- 先“边界与地基”（阶段 1-2），再“核心闭环”（阶段 3），最后“效率与收口”（阶段 4-5）
- 涉及数据模型/IPC/导入导出等关键路径时，同步更新对应文档（对齐 `docs/standards.md`）
- 任何看似需要破例的功能（同步/提醒/重复/自动更新等）先回到 PRD 与红线流程，不在实现中临时加
