# UI 设计规范（shadcn/ui + 极简）

本文档定义 Milesto 的 UI 视觉语言、组件约束与交互标准。

适用范围：Renderer（React）层的页面、组件、样式与交互；以及与 UI 相关的跨进程错误呈现。

关联文档：
- `docs/tech-framework.md`（技术选型、路由、命令面板、性能策略）
- `docs/standards.md`（工程规范、命名规范、错误与文档风格）
- `docs/redlines.md`（性能/安全/IPC/数据等强制红线）

---

## 1. 目标与非目标

### 1.1 目标

- 必须：采用 `shadcn/ui` 作为组件基础（配合 `Tailwind CSS`），以“可组合的原语 + 业务层组合组件”为核心思路。
- 必须：视觉风格保持极简（Minimal）与低噪声：减少装饰性元素，用排版与留白建立层级。
- 必须：对齐 `docs/redlines.md` 的性能要求；10k 任务规模下列表滚动与搜索首屏必须保持流畅。
- 必须：键盘优先（Keyboard-first），常用操作尽量 1-2 次键盘交互完成（对齐 PRD 指标）。
- 必须：跨平台一致（macOS / Windows / Linux），不依赖单一平台专有控件行为。

### 1.2 非目标

- 不做：装饰性强的拟物、重阴影、多渐变、多材质背景。
- 不做：为了“看起来高级”而引入复杂动效或重型视觉资产。
- 不做：在基础 UI 层堆叠业务逻辑（数据获取/IPC/缓存应与纯渲染层分离）。

---

## 2. 设计原则（Minimal UI）

- 必须：信息层级靠排版、间距、对比度建立，而不是靠大量颜色/边框。
- 必须：默认状态尽可能安静；把“强调”留给用户正在执行的动作与系统需要提示的异常。
- 必须：交互即时反馈（hover/focus/pressed/disabled/loading）；避免“点了没反应”的不确定性。
- 必须：可解释与可恢复：错误提示清晰、可重试；危险操作需要确认与撤销（若产品要求）。
- 建议：动效克制且有意义（进入/退出、列表新增/移动），并提供 reduced-motion 兼容。

---

## 3. 信息架构与布局

### 3.1 推荐布局骨架

- 两栏（Sidebar + Content）作为默认布局。
- 必须：内容区的主要滚动容器清晰且唯一，避免嵌套滚动导致滚轮/触控板体验混乱。

### 3.2 导航与入口

- 必须：路由策略遵循 `docs/tech-framework.md`，优先 `HashRouter`（适配 `file://` 场景）。
- v0.1：提供全局搜索入口（SearchPanel）：
  - 入口在内容区底部栏 `Search`（居中遮罩弹窗）
  - 仅搜索 + 跳转：不提供命令列表 / 快速创建
  - 暂不提供 `Cmd/Ctrl + K` 全局快捷键入口
- 建议：侧边栏只承载“信息架构中的固定入口”（Inbox/Today/Upcoming/Projects/Tags/Settings 等），避免把低频功能塞满导航。

---

## 4. 设计变量（Design Tokens）

说明：shadcn/ui 默认使用 CSS 变量表达主题（例如 `--background`、`--foreground`）。本节定义 UI 应遵循的 token 语义与取值范围。

### 4.1 色彩（中性为主）

- 必须：默认采用中性色阶作为主色（背景/边框/文字），避免在主界面大面积使用彩色。
- 建议：只保留少量语义色用于状态：`success / warning / destructive / info`。
- 必须：对比度达标（至少满足常见可读性标准；正文与背景保持足够对比）。

建议语义 token（名称对齐 shadcn 习惯，不代表已落地的具体配置）：
- `background` / `foreground`
- `muted` / `muted-foreground`
- `border` / `input` / `ring`
- `primary` / `primary-foreground`
- `secondary` / `secondary-foreground`
- `destructive` / `destructive-foreground`

### 4.2 排版（克制但有性格）

- 必须：选择一套明确的字体方案并全局一致；避免“默认字体栈”导致不同 OS 下观感漂移。
- 建议：避免使用 Inter/Roboto/Arial/system 默认栈作为最终产品字体；选择更有识别度且可读性强的字体家族。
- 必须：字号与行高有稳定比例；正文建议较高行高以降低阅读疲劳。

建议字号层级（示例）：
- `text-xs`：元信息（时间、标签计数）
- `text-sm`：次要正文（描述、提示）
- `text-base`：主要正文（任务标题、列表主文本）
- `text-lg/xl`：页面标题/关键区块标题

### 4.3 间距与密度

- 必须：采用 4px 步进的间距系统（对齐 Tailwind 常用尺度）。
- 建议：提供“紧凑/标准”两档密度（尤其是任务列表），但默认以可读性优先。

### 4.4 圆角、边框与阴影

- 建议：圆角统一，减少多种半径混用；默认推荐 8px 左右。
- 必须：边框用于“分隔”而非“装饰”，尽量细、尽量少。
- 必须：阴影只用于浮层层级（Dialog/Popover/Dropdown/Tooltip），且保持轻量（避免大面积投影）。

### 4.5 动效（可选但需克制）

- 建议：动效只用于建立空间关系（打开/关闭浮层、列表插入/移动）。
- 必须：支持 reduced-motion（在用户偏好减少动效时降级为无动效或极短过渡）。
- 建议：过渡时长 120-200ms；避免 300ms 以上的“拖沓感”。

---

## 5. 组件体系（基于 shadcn/ui）

### 5.1 使用原则

- 必须：优先组合 shadcn/ui 组件，而不是从零手写一套不一致的 UI。
- 必须：组件对外暴露的 API 以“业务语义”为主；样式细节封装在组件内部。
- 必须：避免为了省事直接暴露底层原语（例如把 `ipcRenderer` 或任意能力透传到 UI），对齐 `docs/redlines.md` 的边界约束。
- 建议：对常用模式沉淀“组合组件”（例如 TaskRow、TaskList、ProjectSidebarItem），而不是在页面里堆积大量布局细节。

### 5.2 推荐组件清单（按场景）

说明：以下为推荐方向，不代表当前仓库已经引入。

- 表单与输入：`Button`、`Input`、`Textarea`、`Select`、`Checkbox`、`Switch`、`Popover`（日期选择可基于 Popover）
- 结构与导航：`Tabs`、`Separator`、`ScrollArea`（谨慎使用，避免嵌套滚动）
- 浮层：`Dialog`、`Sheet`、`DropdownMenu`、`Tooltip`
- （可选/后续）命令入口：`Command`（配合 `cmdk` 生态）
- 反馈：`Toast/Sonner`（计划引入）、`Skeleton`、`Badge`

### 5.3 列表与虚拟滚动（强制）

- 必须：任务列表默认使用虚拟滚动方案（对齐 `docs/redlines.md` 的 10k 规模要求）。
- 必须：列表项渲染只使用必要字段；大文本（如 notes）必须按需加载。
- 建议：虚拟滚动可选 `@tanstack/react-virtual` 或 `react-window`（二选一）。

---

## 6. 交互与键盘规范

### 6.1 全局快捷键（建议基线）

- v0.1：不提供 `Cmd/Ctrl + K` 打开命令面板。
- 建议：`Cmd/Ctrl + F` 聚焦搜索（若产品提供常驻搜索框）。
- 建议：`Cmd/Ctrl + N` 新建任务（或打开快速输入）。
- 建议：`Cmd + ,` 打开设置（macOS 习惯；Windows 可提供等价入口）。

### 6.2 列表导航与选择

- 必须：列表支持键盘上下移动焦点（ArrowUp/ArrowDown），Enter 打开详情。
- 建议：Space 切换完成状态（或触发主要动作），并提供撤销（若产品需要）。
- 必须：焦点可见（focus ring 清晰），不得仅靠颜色微弱变化。

### 6.3 拖拽与窗口行为

- 若采用自绘标题栏：必须为窗口拖拽区域预留 `-webkit-app-region: drag`；交互控件区域必须 `no-drag`，避免点击失效。
- 若支持拖拽排序：必须有键盘等价操作（对齐键盘优先原则）。

---

## 7. 状态设计（Empty / Loading / Error）

### 7.1 Loading

- 必须：关键路径加载提供可感知反馈（Skeleton/Spinner/Progress）。
- 必须：长耗时操作显示“正在进行”的状态，并允许取消或至少可安全重试（视具体场景）。

### 7.2 Empty

- 必须：空状态提供下一步指引（例如“创建任务/导入数据/添加项目”）。
- 建议：文案克制、短句为主；避免大段说明。

### 7.3 Error

- 必须：错误呈现使用统一结构（对齐 `docs/tech-framework.md` 的 `AppError` 约定）：
  - UI 只展示 `code/message`（面向用户可读）
  - `details` 仅用于日志/排障，不直接展示
- 必须：能重试的错误必须提供重试按钮；不能重试的错误要给出替代路径（返回/关闭/复制错误码）。

---

## 8. 可访问性（Accessibility）

- 必须：所有可交互元素可通过键盘到达（Tab 顺序合理），并在聚焦时可见。
- 必须：图标按钮必须提供可访问名称（`aria-label`）或明确文本；纯装饰图标用 `aria-hidden`。
- 必须：弹窗/抽屉类浮层打开时焦点陷阱正确，关闭后焦点回到触发点。
- 建议：支持高对比度与 reduced-motion；避免只用颜色表达状态（如“红/绿”）。

---

## 9. 性能与实现约束（UI 侧）

- 必须：避免在渲染期做重计算；对列表项做 memo 与稳定 key。
- 必须：避免一次性加载/渲染过多 DOM；长列表强制虚拟化。
- 必须：搜索与筛选结果更新要可控（防抖/节流按场景选择），避免每次输入触发大量同步工作。
- 必须：不在 UI 层引入阻塞主线程的操作（对齐 Electron 性能建议）；重任务应通过 worker/后端层处理。

---

## 10. UI 评审清单（提交前自查）

- [ ] 视觉：是否保持极简？是否存在不必要的边框/背景/阴影/装饰？
- [ ] 一致性：相同交互是否使用相同组件与样式变体？
- [ ] 键盘：核心路径是否全键盘可用？焦点是否可见？
- [ ] 可访问性：图标按钮是否有 `aria-label`？Dialog/Sheet 是否正确管理焦点？
- [ ] 状态：Loading/Empty/Error 是否齐全？错误是否只展示 `code/message`？
- [ ] 性能：列表是否虚拟化？是否避免加载大字段？输入/搜索是否避免卡顿？
